import{_ as M}from"./loginChat.vue_vue_type_style_index_0_lang-59ff926a.js";import{aS as u,aJ as c,a6 as m,bl as n,a7 as C,c as o,bn as F,a9 as S,G as r,d as A,r as B,o as I}from"./@vue-7e44e6dd.js";import{_ as $}from"./_plugin-vue_export-helper-c27b6911.js";import{l as i}from"./vuetify-e7ea846c.js";import{u as k}from"./userShare-b0cad5ec.js";import{u as U,i as y}from"../index-09e45bbf.js";import{m as a}from"./ant-design-vue-6548dd29.js";const E=r("立即登录"),P=r("OR"),T={class:"otherlogin"},b=r("忘记密码"),D=r("立即注册");function R(e,t,p,l,g,w){const d=u("a-alert"),h=u("a-input"),f=u("a-input-password"),_=u("a-divider"),v=u("a-modal");return c(),m(v,{style:{top:"30%"},"z-index":"1009",footer:null,open:e.userStore.loginModal,"onUpdate:open":t[2]||(t[2]=s=>e.userStore.loginModal=s),width:"350px",title:"用户登录"},{default:n(()=>[e.newuserdays>=0?(c(),m(d,{key:0,class:"mt-3",message:`新用户注册立即赠送${e.newuserdays}天普通会员资格`,type:"success"},null,8,["message"])):C("",!0),o(h,{class:"mt-5",value:e.useremail,"onUpdate:value":t[0]||(t[0]=s=>e.useremail=s),placeholder:"请输入您的邮箱地址"},null,8,["value"]),o(f,{class:"mt-5",value:e.password,"onUpdate:value":t[1]||(t[1]=s=>e.password=s),placeholder:"请输入您的账户密码",onKeyup:F(e.userlogin,["enter"])},null,8,["value","onKeyup"]),o(i,{class:"mt-5 loginbutton",onClick:e.userlogin},{default:n(()=>[E]),_:1},8,["onClick"]),o(_,null,{default:n(()=>[P]),_:1}),S("div",T,[o(i,{class:"mt-5 otherbutton",onClick:e.passModel},{default:n(()=>[b]),_:1},8,["onClick"]),o(i,{class:"mt-5 otherbutton",onClick:e.registModel},{default:n(()=>[D]),_:1},8,["onClick"])])]),_:1},8,["open"])}const Y=$(M,[["render",R]]),V=A({setup(){const e=k(),t=U(),p=B(0),l=B(!1);return I(async()=>{if(await t.loadSettingsFromAPI(),p.value=Number(t.getSetting("new_user_days")),t.getSetting("paymentSwitch")){const g=new URL(window.location.href).hostname,w=t.getSetting("domainAddress"),d=t.getSetting("navSwitchAll");g===w||d===!1?l.value=!0:l.value=!1}}),{userStore:e,newuserdays:p,paytrue:l}},data(){return{useremail:"",emailcode:"",userPasswordInput:"",invcode:this.$route.query.share,countdown:null,countdownTime:30}},methods:{validateInputs(){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.useremail)?this.userPasswordInput.length<8?(a.warning("用户密码不得小于8位字符，请重新输入"),!1):!0:(a.warning("请输入有效的电子邮箱"),!1)},emailget(){if(this.countdown===null){if(this.useremail===""){a.warning("请输入您的电子邮箱");return}this.emailcode="",this.registpost()}},registclick(){this.validateInputs()&&this.registpost()},registpost(){const e=window.VITE_API_BASE_URL;y.post(e+"/app/user/regeister",{email:this.useremail,emailcode:this.emailcode,password:this.userPasswordInput,invcode:this.invcode}).then(t=>{if(t.data.data.code===200){a.success(t.data.data.msg);return}if(t.data.data.code===201){a.success(t.data.data.msg),this.userStore.registModel=!1,this.userStore.loginModal=!0,this.userPasswordInput="",this.useremail="",this.emailcode="";return}}).catch(t=>{console.error("请求错误:",t)})},loginModel(){this.userStore.registModel=!1,this.userStore.loginModal=!0},usertoeknModel(){this.userStore.registModel=!1,this.userStore.userTokenModel=!0}}});const N=r("立即注册"),z=r("OR"),K={class:"otherlogin"},L=r("已有UserToken"),O=r("已有账户");function q(e,t,p,l,g,w){const d=u("a-alert"),h=u("a-input"),f=u("a-input-password"),_=u("a-divider"),v=u("a-modal");return c(),m(v,{style:{top:"30%"},"z-index":"1009",footer:null,open:e.userStore.registModel,"onUpdate:open":t[3]||(t[3]=s=>e.userStore.registModel=s),width:"350px",title:"新用户注册"},{default:n(()=>[e.newuserdays>=0?(c(),m(d,{key:0,class:"mt-3",message:`新用户注册立即赠送${e.newuserdays}天普通会员资格`,type:"success"},null,8,["message"])):C("",!0),o(h,{class:"mt-5",value:e.useremail,"onUpdate:value":t[0]||(t[0]=s=>e.useremail=s),placeholder:"请输入您的电子邮箱"},null,8,["value"]),o(f,{class:"mt-5",value:e.userPasswordInput,"onUpdate:value":t[1]||(t[1]=s=>e.userPasswordInput=s),placeholder:"请输入您的账户密码"},null,8,["value"]),e.paytrue?(c(),m(h,{key:1,class:"mt-5",value:e.invcode,"onUpdate:value":t[2]||(t[2]=s=>e.invcode=s),placeholder:"邀请码（选填）"},null,8,["value"])):C("",!0),o(i,{class:"mt-5 loginbutton",onClick:e.registclick},{default:n(()=>[N]),_:1},8,["onClick"]),o(_,null,{default:n(()=>[z]),_:1}),S("div",K,[o(i,{class:"mt-5 otherbutton",onClick:e.usertoeknModel},{default:n(()=>[L]),_:1},8,["onClick"]),o(i,{class:"mt-5 otherbutton",onClick:e.loginModel},{default:n(()=>[O]),_:1},8,["onClick"])])]),_:1},8,["open"])}const Z=$(V,[["render",q]]),x=A({setup(){return{userStore:k()}},data(){return{useremail:"",userpassword:"",emailcode:"",emailmsg:"获取验证码",countdown:null,countdownTime:30}},methods:{startCountdown(){this.countdownTime=30,this.emailmsg=`${this.countdownTime}秒后重新获取`,this.countdown=setInterval(()=>{this.countdownTime--,this.countdownTime>0?this.emailmsg=`${this.countdownTime}秒后重新获取`:(this.emailmsg="获取验证码",clearInterval(this.countdown),this.countdown=null)},1e3)},loginModel(){this.userStore.passModel=!1,this.userStore.loginModal=!0},emailget(){if(this.countdown!==null)return;if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.useremail))return a.warning("请输入有效的电子邮箱"),!1;this.emailcode="",this.startCountdown(),this.resetPassword()},forgetbutton(){this.validateInputs()&&this.resetPassword()},validateInputs(){return/^\d{6}$/.test(this.emailcode)?this.userpassword.length<8?(a.warning("用户密码不得小于8位字符，请重新输入"),!1):!0:(a.warning("验证码必须是6位纯数字"),!1)},resetPassword(){const e=window.VITE_API_BASE_URL;y.post(e+"/app/user/forget",{useremail:this.useremail,emailcode:this.emailcode,password:this.userpassword}).then(t=>{if(t.data.data.code===400){a.warning(t.data.data.msg),this.countdown!==null&&(clearInterval(this.countdown),this.countdown=null,this.emailmsg="获取验证码");return}if(t.data.data.code===201){a.success(t.data.data.msg),this.userStore.passModel=!1,this.userStore.loginModal=!0,this.useremail=null,this.userpassword=null,this.emailcode=null,this.countdown!==null&&(clearInterval(this.countdown),this.countdown=null,this.emailmsg="获取验证码");return}}).catch(t=>{console.error("请求错误:",t)})}}});export{Z as R,x as _,Y as l};
