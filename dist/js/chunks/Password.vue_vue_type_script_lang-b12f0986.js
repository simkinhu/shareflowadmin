import{_ as M}from"./loginChat.vue_vue_type_style_index_0_lang-12296bf3.js";import{aS as n,aJ as f,a6 as _,bl as o,c as s,bn as y,G as i,d as C,r as A,o as T,a7 as U,b2 as b}from"./@vue-7e44e6dd.js";import{_ as v}from"./_plugin-vue_export-helper-c27b6911.js";import{n as r}from"./vuetify-0a3604cc.js";import{u as B}from"./userShare-cefa2c5b.js";import{u as D,i as F}from"../index-02d08ce6.js";import{m as u}from"./ant-design-vue-32902922.js";const E=i("立即登录"),P=i("OR"),R=i("注册"),V=i("已有UserToken"),z=i("忘记密码?");function N(e,t,m,k,S,$){const p=n("a-alert"),d=n("a-input"),c=n("a-input-password"),h=n("a-divider"),g=n("a-space"),w=n("a-modal");return f(),_(w,{style:{top:"25%"},"z-index":"1009",footer:null,open:e.userStore.loginModal,"onUpdate:open":t[2]||(t[2]=l=>e.userStore.loginModal=l),width:"350px",title:"用户登录"},{default:o(()=>[s(p,{class:"mt-3",message:"已有 UserToken 的用户，请点击下面 “已有UserToken” 进行登录",type:"success"}),s(d,{class:"mt-5",value:e.useremail,"onUpdate:value":t[0]||(t[0]=l=>e.useremail=l),placeholder:"请输入您的邮箱地址"},null,8,["value"]),s(c,{class:"mt-5",value:e.password,"onUpdate:value":t[1]||(t[1]=l=>e.password=l),placeholder:"请输入您的账户密码",onKeyup:y(e.userlogin,["enter"])},null,8,["value","onKeyup"]),s(r,{class:"mt-5 loginbutton",onClick:e.userlogin},{default:o(()=>[E]),_:1},8,["onClick"]),s(h,null,{default:o(()=>[P]),_:1}),s(g,{class:"otherlogin"},{default:o(()=>[s(r,{class:"mt-5 otherbutton",onClick:e.registModel},{default:o(()=>[R]),_:1},8,["onClick"]),s(r,{class:"mt-5 otherbutton","x-small":"",onClick:e.usertoeknModel},{default:o(()=>[V]),_:1},8,["onClick"]),s(r,{class:"mt-5 otherbutton",onClick:e.passModel},{default:o(()=>[z]),_:1},8,["onClick"])]),_:1})]),_:1},8,["open"])}const Z=v(M,[["render",N]]),K=C({setup(){const e=B(),t=D(),m=A(0);return T(async()=>{await t.loadSettingsFromAPI(),m.value=Number(t.getSetting("new_user_days"))}),{userStore:e,newuserdays:m}},data(){return{email:"",emailcode:"",userPasswordInput:"",invcode:this.$route.query.share,emailmsg:"获取验证码",countdown:null,countdownTime:30}},methods:{validateInputs(){const e=/^\d{6}$/,t=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return e.test(this.emailcode)?t.test(this.email)?this.userPasswordInput.length<8?(u.warning("用户密码不得小于8位字符，请重新输入"),!1):!0:(u.warning("请输入有效的电子邮箱"),!1):(u.warning("验证码必须是6位纯数字"),!1)},emailget(){if(this.countdown===null){if(this.email===""){u.warning("请输入您的电子邮箱");return}this.emailcode="",this.startCountdown(),this.registpost()}},startCountdown(){this.countdownTime=30,this.emailmsg=`${this.countdownTime}秒后重新获取`,this.countdown=setInterval(()=>{this.countdownTime--,this.countdownTime>0?this.emailmsg=`${this.countdownTime}秒后重新获取`:(this.emailmsg="获取验证码",clearInterval(this.countdown),this.countdown=null)},1e3)},registclick(){this.validateInputs()&&this.registpost()},registpost(){const e=window.VITE_API_BASE_URL;F.post(e+"/app/user/regeister",{email:this.email,emailcode:this.emailcode,password:this.userPasswordInput,invcode:this.invcode}).then(t=>{if(t.data.data.code===200&&t.data.data.type===1){u.success(t.data.data.msg),this.userStore.registModel=!1,this.userStore.loginModal=!0;return}if(t.data.data.code===400){u.warning(t.data.data.msg),this.email="",this.countdown!==null&&(clearInterval(this.countdown),this.countdown=null,this.emailmsg="获取验证码");return}}).catch(t=>{console.error("请求错误:",t)})},loginModel(){this.userStore.registModel=!1,this.userStore.loginModal=!0}}});const q=i("立即注册"),L=i("OR"),O=i("已有账户？");function G(e,t,m,k,S,$){const p=n("a-alert"),d=n("a-input"),c=n("a-col"),h=n("a-row"),g=n("a-input-group"),w=n("a-input-password"),l=n("a-divider"),I=n("a-modal");return f(),_(I,{style:{top:"20%"},"z-index":"1009",footer:null,open:e.userStore.registModel,"onUpdate:open":t[4]||(t[4]=a=>e.userStore.registModel=a),width:"350px",title:"新用户注册"},{default:o(()=>[e.newuserdays>=0?(f(),_(p,{key:0,class:"mt-3",message:`新用户注册立即赠送${e.newuserdays}天普通会员资格`,type:"success"},null,8,["message"])):U("",!0),s(d,{class:"mt-5",value:e.email,"onUpdate:value":t[0]||(t[0]=a=>e.email=a),placeholder:"请输入您的电子邮箱"},null,8,["value"]),s(g,{class:"mt-5"},{default:o(()=>[s(h,{gutter:24},{default:o(()=>[s(c,{span:12},{default:o(()=>[s(d,{value:e.emailcode,"onUpdate:value":t[1]||(t[1]=a=>e.emailcode=a),placeholder:"请输入邮箱验证码"},null,8,["value"])]),_:1}),s(c,{span:12},{default:o(()=>[s(r,{block:"true",outlined:"",size:"small",class:"loginbutton qrcodebutton",onClick:e.emailget},{default:o(()=>[i(b(e.emailmsg),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}),s(w,{class:"mt-5",value:e.userPasswordInput,"onUpdate:value":t[2]||(t[2]=a=>e.userPasswordInput=a),placeholder:"请输入您的账户密码"},null,8,["value"]),s(d,{class:"mt-5",value:e.invcode,"onUpdate:value":t[3]||(t[3]=a=>e.invcode=a),placeholder:"邀请码（选填）"},null,8,["value"]),s(r,{class:"mt-5 loginbutton",onClick:e.registclick},{default:o(()=>[q]),_:1},8,["onClick"]),s(l,null,{default:o(()=>[L]),_:1}),s(r,{class:"mt-5 loginbutton",onClick:e.loginModel},{default:o(()=>[O]),_:1},8,["onClick"])]),_:1},8,["open"])}const x=v(K,[["render",G]]),ee=C({setup(){return{userStore:B()}},data(){return{useremail:"",userpassword:"",emailcode:"",emailmsg:"获取验证码",countdown:null,countdownTime:30}},methods:{startCountdown(){this.countdownTime=30,this.emailmsg=`${this.countdownTime}秒后重新获取`,this.countdown=setInterval(()=>{this.countdownTime--,this.countdownTime>0?this.emailmsg=`${this.countdownTime}秒后重新获取`:(this.emailmsg="获取验证码",clearInterval(this.countdown),this.countdown=null)},1e3)},loginModel(){this.userStore.passModel=!1,this.userStore.loginModal=!0},emailget(){if(this.countdown!==null)return;if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.useremail))return u.warning("请输入有效的电子邮箱"),!1;this.emailcode="",this.startCountdown(),this.resetPassword()},forgetbutton(){this.validateInputs()&&this.resetPassword()},validateInputs(){return/^\d{6}$/.test(this.emailcode)?this.userpassword.length<8?(u.warning("用户密码不得小于8位字符，请重新输入"),!1):!0:(u.warning("验证码必须是6位纯数字"),!1)},resetPassword(){const e=window.VITE_API_BASE_URL;F.post(e+"/app/user/forget",{useremail:this.useremail,emailcode:this.emailcode,password:this.userpassword}).then(t=>{if(t.data.data.code===400){u.warning(t.data.data.msg),this.countdown!==null&&(clearInterval(this.countdown),this.countdown=null,this.emailmsg="获取验证码");return}if(t.data.data.code===201){u.success(t.data.data.msg),this.userStore.passModel=!1,this.userStore.loginModal=!0,this.useremail=null,this.userpassword=null,this.emailcode=null,this.countdown!==null&&(clearInterval(this.countdown),this.countdown=null,this.emailmsg="获取验证码");return}}).catch(t=>{console.error("请求错误:",t)})}}});export{x as R,ee as _,Z as l};
