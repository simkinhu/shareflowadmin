import{_ as T}from"./loginChat.vue_vue_type_style_index_0_lang-d87b27ca.js";import{aS as u,aJ as p,a6 as h,bl as o,a7 as B,c as s,bn as U,a9 as $,G as i,d as k,r as S,o as b,b2 as E}from"./@vue-7e44e6dd.js";import{_ as A}from"./_plugin-vue_export-helper-c27b6911.js";import{m as r}from"./vuetify-c962898f.js";import{u as y}from"./userShare-3887ce2e.js";import{u as P,i as F}from"../index-451927d2.js";import{m as n}from"./ant-design-vue-32902922.js";const D=i("立即登录"),R=i("OR"),V={class:"otherlogin"},N=i("忘记密码"),z=i("立即注册");function K(e,t,g,d,f,_){const m=u("a-alert"),c=u("a-input"),w=u("a-input-password"),v=u("a-divider"),C=u("a-modal");return p(),h(C,{style:{top:"30%"},"z-index":"1009",footer:null,open:e.userStore.loginModal,"onUpdate:open":t[2]||(t[2]=l=>e.userStore.loginModal=l),width:"350px",title:"用户登录"},{default:o(()=>[e.newuserdays>=0?(p(),h(m,{key:0,class:"mt-3",message:`新用户注册立即赠送${e.newuserdays}天普通会员资格`,type:"success"},null,8,["message"])):B("",!0),s(c,{class:"mt-5",value:e.useremail,"onUpdate:value":t[0]||(t[0]=l=>e.useremail=l),placeholder:"请输入您的邮箱地址"},null,8,["value"]),s(w,{class:"mt-5",value:e.password,"onUpdate:value":t[1]||(t[1]=l=>e.password=l),placeholder:"请输入您的账户密码",onKeyup:U(e.userlogin,["enter"])},null,8,["value","onKeyup"]),s(r,{class:"mt-5 loginbutton",onClick:e.userlogin},{default:o(()=>[D]),_:1},8,["onClick"]),s(v,null,{default:o(()=>[R]),_:1}),$("div",V,[s(r,{class:"mt-5 otherbutton",onClick:e.passModel},{default:o(()=>[N]),_:1},8,["onClick"]),s(r,{class:"mt-5 otherbutton",onClick:e.registModel},{default:o(()=>[z]),_:1},8,["onClick"])])]),_:1},8,["open"])}const te=A(T,[["render",K]]),L=k({setup(){const e=y(),t=P(),g=S(0),d=S(!1);return b(async()=>{if(await t.loadSettingsFromAPI(),g.value=Number(t.getSetting("new_user_days")),t.getSetting("paymentSwitch")){const f=new URL(window.location.href).hostname,_=t.getSetting("domainAddress"),m=t.getSetting("navSwitchAll");f===_||m===!1?d.value=!0:d.value=!1}}),{userStore:e,newuserdays:g,paytrue:d}},data(){return{useremail:"",emailcode:"",userPasswordInput:"",invcode:this.$route.query.share,emailmsg:"获取验证码",countdown:null,countdownTime:30}},methods:{validateInputs(){const e=/^\d{6}$/,t=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return e.test(this.emailcode)?t.test(this.useremail)?this.userPasswordInput.length<8?(n.warning("用户密码不得小于8位字符，请重新输入"),!1):!0:(n.warning("请输入有效的电子邮箱"),!1):(n.warning("验证码必须是6位纯数字"),!1)},emailget(){if(this.countdown===null){if(this.useremail===""){n.warning("请输入您的电子邮箱");return}this.emailcode="",this.startCountdown(),this.registpost()}},startCountdown(){this.countdownTime=30,this.emailmsg=`${this.countdownTime}秒后重新获取`,this.countdown=setInterval(()=>{this.countdownTime--,this.countdownTime>0?this.emailmsg=`${this.countdownTime}秒后重新获取`:(this.emailmsg="获取验证码",clearInterval(this.countdown),this.countdown=null)},1e3)},registclick(){this.validateInputs()&&this.registpost()},registpost(){const e=window.VITE_API_BASE_URL;F.post(e+"/app/user/regeister",{email:this.useremail,emailcode:this.emailcode,password:this.userPasswordInput,invcode:this.invcode}).then(t=>{if(t.data.data.code===200){n.success(t.data.data.msg);return}if(t.data.data.code===201){n.success(t.data.data.msg),this.userStore.registModel=!1,this.userStore.loginModal=!0,this.userPasswordInput="",this.useremail="",this.emailcode="";return}if(t.data.data.code===400){n.warning(t.data.data.msg),this.useremail="",this.countdown!==null&&(clearInterval(this.countdown),this.countdown=null,this.emailmsg="获取验证码");return}}).catch(t=>{console.error("请求错误:",t)})},loginModel(){this.userStore.registModel=!1,this.userStore.loginModal=!0},usertoeknModel(){this.userStore.registModel=!1,this.userStore.userTokenModel=!0}}});const q=i("立即注册"),O=i("OR"),G={class:"otherlogin"},H=i("已有UserToken"),J=i("已有账户");function j(e,t,g,d,f,_){const m=u("a-alert"),c=u("a-input"),w=u("a-col"),v=u("a-row"),C=u("a-input-group"),l=u("a-input-password"),I=u("a-divider"),M=u("a-modal");return p(),h(M,{style:{top:"25%"},"z-index":"1009",footer:null,open:e.userStore.registModel,"onUpdate:open":t[4]||(t[4]=a=>e.userStore.registModel=a),width:"350px",title:"新用户注册"},{default:o(()=>[e.newuserdays>=0?(p(),h(m,{key:0,class:"mt-3",message:`新用户注册立即赠送${e.newuserdays}天普通会员资格`,type:"success"},null,8,["message"])):B("",!0),s(c,{class:"mt-5",value:e.useremail,"onUpdate:value":t[0]||(t[0]=a=>e.useremail=a),placeholder:"请输入您的电子邮箱"},null,8,["value"]),s(C,{class:"mt-5"},{default:o(()=>[s(v,{gutter:24},{default:o(()=>[s(w,{span:12},{default:o(()=>[s(c,{value:e.emailcode,"onUpdate:value":t[1]||(t[1]=a=>e.emailcode=a),placeholder:"请输入邮箱验证码"},null,8,["value"])]),_:1}),s(w,{span:12},{default:o(()=>[s(r,{block:"true",outlined:"",size:"small",class:"loginbutton qrcodebutton",onClick:e.emailget},{default:o(()=>[i(E(e.emailmsg),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}),s(l,{class:"mt-5",value:e.userPasswordInput,"onUpdate:value":t[2]||(t[2]=a=>e.userPasswordInput=a),placeholder:"请输入您的账户密码"},null,8,["value"]),e.paytrue?(p(),h(c,{key:1,class:"mt-5",value:e.invcode,"onUpdate:value":t[3]||(t[3]=a=>e.invcode=a),placeholder:"邀请码（选填）"},null,8,["value"])):B("",!0),s(r,{class:"mt-5 loginbutton",onClick:e.registclick},{default:o(()=>[q]),_:1},8,["onClick"]),s(I,null,{default:o(()=>[O]),_:1}),$("div",G,[s(r,{class:"mt-5 otherbutton",onClick:e.usertoeknModel},{default:o(()=>[H]),_:1},8,["onClick"]),s(r,{class:"mt-5 otherbutton",onClick:e.loginModel},{default:o(()=>[J]),_:1},8,["onClick"])])]),_:1},8,["open"])}const se=A(L,[["render",j]]),oe=k({setup(){return{userStore:y()}},data(){return{useremail:"",userpassword:"",emailcode:"",emailmsg:"获取验证码",countdown:null,countdownTime:30}},methods:{startCountdown(){this.countdownTime=30,this.emailmsg=`${this.countdownTime}秒后重新获取`,this.countdown=setInterval(()=>{this.countdownTime--,this.countdownTime>0?this.emailmsg=`${this.countdownTime}秒后重新获取`:(this.emailmsg="获取验证码",clearInterval(this.countdown),this.countdown=null)},1e3)},loginModel(){this.userStore.passModel=!1,this.userStore.loginModal=!0},emailget(){if(this.countdown!==null)return;if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.useremail))return n.warning("请输入有效的电子邮箱"),!1;this.emailcode="",this.startCountdown(),this.resetPassword()},forgetbutton(){this.validateInputs()&&this.resetPassword()},validateInputs(){return/^\d{6}$/.test(this.emailcode)?this.userpassword.length<8?(n.warning("用户密码不得小于8位字符，请重新输入"),!1):!0:(n.warning("验证码必须是6位纯数字"),!1)},resetPassword(){const e=window.VITE_API_BASE_URL;F.post(e+"/app/user/forget",{useremail:this.useremail,emailcode:this.emailcode,password:this.userpassword}).then(t=>{if(t.data.data.code===400){n.warning(t.data.data.msg),this.countdown!==null&&(clearInterval(this.countdown),this.countdown=null,this.emailmsg="获取验证码");return}if(t.data.data.code===201){n.success(t.data.data.msg),this.userStore.passModel=!1,this.userStore.loginModal=!0,this.useremail=null,this.userpassword=null,this.emailcode=null,this.countdown!==null&&(clearInterval(this.countdown),this.countdown=null,this.emailmsg="获取验证码");return}}).catch(t=>{console.error("请求错误:",t)})}}});export{se as R,oe as _,te as l};
